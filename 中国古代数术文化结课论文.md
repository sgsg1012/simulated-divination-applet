[toc]

# 计算机模拟数术筮占过程

​																		                                                    ——中国古代数术文化结课论文

## 前言	

​	中国古代数术是预卜将来之事，此所谓“占卜”，是古代的“未来学”。这类预测术是以推算、筹画为基础，德国汉学家朗宓榭说：“中国预测以计算为基础，而西方的预测更多的是建立在先知的前提下。” 中国古代数术即便不是全都建立在计算的基础之上，但其主体和最重要的特点应是如此，其计算基本原理则是阴阳五行的生克变化。

​	中国古代数术的历史，既是数术本身发则的历史，同时也是古人对“数术”认识的历史。古代数术大略可分为与“天”有关的数术（星占、式法、选择等），与“地”有关的数术（龟卜筮占、堪舆风水）和与“人”有关的数术（相术、星命、梦占）三大类。从历史发展上看，商周时期以龟卜筮占为主，战国秦汉时期流行星占、式法和选择，唐宋时期各种命术和堪舆风水异军突起，龟卜和图谶逐渐消亡，式法经改良重发光彩，“五行”成为数术的代名词；明清时期尤以风水和星命相术最为发达，唐宋时期盛极一时的式占日益式微。而在各种数术中，以易为核心的筮占，一直盛行不衰。

​	筮占，是用蓍草演算成卦占卜吉凶，如果说龟卜的“象”占的话，筮占则是“数”占。用筮占形成的《周易》，后成为儒家经典，稳居六经九经十三经之首，这在全世界也是独一无二的。晏昌贵老师在一次课上使用扑克牌演示了春秋古筮法时，学生就萌生了使用计算机模拟筮占过程的想法，因此成为我的结课论文的选题。

​	现今所见，一般把《系辞》“大衍之数”章视作“春秋古筮法”，西汉易学家京房创立的“纳甲筮法”，以及相传为北宋易学家邵雍所创的“梅花易数”，并为三大筮法。因为时间原因，学生只实现了前两种筮占方法，也就是“春秋古筮法”和”纳甲筮法“。

## 程序环境

语言：cpp

可视化界面：QT

## 易占基本知识

### 易占的符号系统

易占的基本符号是阴爻和阳爻，用一横画表示阳爻，中间断开为阴爻。“阴”和“阳”是中国古代哲学中的一对表示矛盾的概念，也是古人对世界的二元划分。“阳（昜）”的本义是指面向太阳光的一面，“阴（陰）”则是指背阳的一面，中国处于北半球，山的南面为阳、北面为阴，南方为阳、北方为阴，太阳从东方升起，是阳；从西方落下，是阴。古代的方位观念里，东可以概指南，西可以概指北，所以阴阳最初也许是表示古代方位空间观念的名词。中国古地图，南方在上，北方在下，所以南为阳、北为阴。从时间季节上讲，白天为阳，夜晚为阴；夏天阳光充足，是阳；冬天阴沉冷寂，为阴。从人的角度来讲，男性（雄）为阳，女性（雌）为阴，动物亦然。引而申之，一切刚强的、明亮的、热烈性，都是阳；反之，柔弱的、黑暗的、冷酷的，都是阴。从数的角度，所有奇数都是阳，偶数阴。《周易》用阴、阳爻这两个符号表示一切相互对立的两种事物，是一种原始二元世界观。

### 易占的文字系统

《周易》的文字系统通常包括卦辞、爻辞，一般认为卦辞是对卦象的文字说明，爻辞是爻象的文字说明，卦爻辞连同六十四卦一起被尊称为“经”。六十四卦每卦有一个卦名，所谓“循名责实”，“名不正则言不顺，言不顺则事不成”，卦名不仅是一种称号，在实际占卦过程中，也常常利用卦名为占，具有占卜的功能。**64卦的得名有的取名于卦象**，如《需》卦 ，上为坎，象水象雨，下为乾，象天。卦名“需”字古文正是“雨”在“天”上。《鼎》卦 ，下象鼎足（趾），二三四爻象鼎腹（鼎实），五爻象鼎耳，上九象鼎“铉”（贯穿鼎耳，抬举鼎用的杠子）。又如《剥》卦 象阴气逐渐剥落阳气，《复》卦 象征一阳来复；《泰》卦 三阴爻在上，三阳爻在下，象征天气（清气）上升、地气（浊气）下降，阴阳交泰、男女交配，生成万物；《否》卦 则正好相反，天气不断上升，地气不断下沉，二者形成背反之形势。卦名不仅取象于卦形，还代表卦之义和卦之德，如《乾》卦，帛易写“键”，通假为“健”，比喻《乾》卦之德为刚健、健行；《坤》卦帛易作“川”，即“顺”字，代表《坤》卦之德义为阴柔、顺承。《既济》 每爻都当位，“既”为已经，“济”的本义为渡河，比如成功，“既济”比喻所有矛盾都得到圆满地解决，所有事项都处于和谐状态；《未济》 则正好相反，所有的爻都不得位。

### 易占的操作系统

《周易》经传只是待查的文本，好比下棋，《易经》相当于棋谱的精选集，但如何下棋，却没有告诉你。这种教人下棋的法子，在《易》占就被称为“筮法”。我们知道，殷周之际曾流行数字卦，直到战国时期楚国的卜筮简仍然流行，所见数字除6、7、8、9外，还有1、4、5、10等，这些数字按《周易》所载的古筮法是推算不出来的，换言之，数字卦的古筮法已经失传了。现今所见，一般把《系辞》“大衍之数”章视作“春秋古筮法”，西汉易学家京房创立的“纳甲筮法”，以及相传为北宋易学家邵雍所创的“梅花易数”，并为三大筮法。此外，在民间还流行诸多简易的筮占法，如灵棋经、轨革卜、马头占、火珠林、各种签牌神数，林林总总，数不胜数。

## 三大筮法介绍和程序分析

### 春秋古筮法

#### 古文描述

大衍之数五十，其用四十有九。分而为二以象两，挂一以象三，揲之以四以象四时，归奇于扐以象闰，五岁再闰，故再扐而后挂。
天数五，地数五，五位相得而各有合。天数二十有五，地数三十，凡天地之数五十有五。此所以成变化而行鬼神也。
乾之策二百一十有六，坤之策百四十有四，凡三百有六十，当期之日。二篇之策，万有一千五百二十，当万物之数也。
是故四营而成易，十有八变而成卦，八卦而小成，引而伸之，触类而长之，天下之能事毕矣。（《系辞上》）

#### 起卦 （三变而成爻、十八变而成卦）

1. 拿50根蓍草（用小木棒或扑克牌均可。50是“大衍之数”），抽去1根（以象天）。这是第一步。
2. 将49策随意分为二部分，分上、下放在桌面上，象征“太极分两仪”，“两仪”即是阴、阳，也是天、地。这是第二步。
3. 从两堆蓍策中任取一策，放在二者之间，即“挂一以象三”，象征天、人、地三才，在实际操作，可将1策挂于左手小指。
4. 从两堆蓍草中先选一堆，每4策分为一组，也就是以4除之，此即“揲之以四以象四时”，四时即四季。
5. 将剩下的余策夹在手指间，“归奇于扐以象闰”，以象征闰年
6. 然后再数另一堆蓍草，仍然是以4除之。中国古代实行阴阳合历，根据太阳运行周期制定历法称阴历，根据月亮周期制定历法为阴历，太阳周期是一年365又4分之一天，月亮周期是354天，为了协调二者，便有置闰的需要，三年一闰，五年二闰，所以说“五岁再闰，故再扐而后挂”。
7. 上述5、6两个步骤，方法是一样的，都是将二分的蓍策以4除之，所得的结果也是一样的，即1、2、3、4。注意：以4相除的余数没有零（0），4也是余策。由于总数（蓍策数量）是49，最后剩余的蓍策也有4种情况：当上边蓍策的余数为1时，下边一定是3，上边为2，下边也是2，上边是3，下边必为1，上边为4，下边也为4，然后加上放在中间的那根蓍策，总数要么是5（1+3+1，2+2+1），要么是9（4+4+1）。这是第一变。
8. 将剩余的44根蓍策（49-5）或40（49-9）用上述②至⑥的方法步骤再演算一遍，结果如果上边剩余为1，下边必为2；上边为2，下边则为1；上边为3，下边必为4；上边为4，下边必为3。加上放在中间的那张牌，其和也只有两种情况：4（1+3+1）和8（3+4+1）。这是第二变。
9. 将剩余的40根蓍策[49-（5+4）]或36策[49-（5+8/9+4）]或32策[49-（9+8）]用同样的方法演算，所得余数与第二变相同。这是第三变。三变之后，剩余的蓍策数有4种情况：36（40-4）、32（40-8/36-4）、28（36-8/32-4）、24（32-8）。这4个数再除4，可得9（老阳）、8（少阴）、7（少阳）、6（老阴）四个数字。当最后结果是9和7时，可画一阳爻符号（—），当结果是6和8时，可画一阴爻符号（--）。
10. 经过三变可得一爻，一个六画卦有6爻，所以说十八变而成卦。

#### 变卦

《周易》以变为占，当筮得老阳（9）时，阳爻变阴爻，筮得老阴（6）时，阴爻要变阳爻。少阳（7）和少阴（8）则不变。

#### 程序模拟春秋古筮法

##### 一变

```cpp
//一变开始

//初始蓍草数量: num
int num=49;
//随机分成两部分:num1,num2
int num1=rand()%(num-1)+1;
int num2=num-num1;
//从两堆蓍策中任取一策，放在二者之间
if(num1>1) num1--;
else num2--;
//每4策分为一组，也就是以4除之，此即“揲之以四以象四时”，四时即四季。
//左右两堆分别以4除之
int rem1=num1%4;
if(rem1==0) rem1=4;
int rem2=num2%4;
if(rem2==0) rem2=4;
//剩余蓍策数量
int res=num-1-rem1-rem2;

//一变结束
```

##### 一爻

```cpp
//三变而成爻
//大衍之数五十，其用四十有九
int num=50;
//抽去1根（以象天）
num--;
//第一变
num = bian(num);//bian(num) 为一变 , num变成剩余蓍策数量
//第二变
num = bian(num);
//第三变
num = bian(num);
//剩余的蓍策数除以4,结果可能是6,7,8,9
//这里先不考虑变卦，在成卦时再考虑变卦
if(num==9||num==7) //阳爻
{
    s+="可画一阳爻:---\n";
}
else if(num==6||num==8) //阴爻
{
    s+="可画一阴爻:- -\n";
}
```

##### 一卦

```cpp
//三变而成爻、十八变而成卦
//一卦六爻
int arr[6];//记录六爻
//六爻
for(int i=0;i<6;i++)
{
    arr[i]=yao();
}
//卦象
for(int i=0;i<6;i++)
{
    if(arr[i]==9||arr[i]==7)//阳爻
    {
        s+="---\n";
    }
    else if(arr[i]==6||arr[i]==8) //阴爻
    {
        s+="- -\n";
    }
}
//变卦
for(int i=0;i<6;i++)
{
    if(arr[i]==6||arr[i]==7)//老阴 --> 少阳
    {
        s+="---\n";
    }
    else if(arr[i]==9||arr[i]==8)//老阳 --> 少阴
    {
        s+="- -\n";
    }
}
```

### 纳甲筮法（金钱卦）

#### 起卦

1. 用铜钱3枚（最好是汉代五铢钱）合于掌中摇动后掷出；
2. 掷出的铜钱若1个背面，2个正面，记作少阳 ┃，又称“单”；
3. 2个背面，1个正面，记作少阴‖，又称“拆”；
4. 3个背面记作老阳□或○，又称“重”；
5. 3个正面记作老阴㐅，又称“交”。
6. 若遇老阳则化为少阴，遇老阴化为少阳。

#### 程序模拟过程

##### 一爻

```cpp
//模拟掷出三枚铜钱
int val=rand()%8;//val随机一个0~7的数，二进制表示为000~111，正好对应三枚硬币
int arr[3];//arr记录三枚硬币的正反
int num=0;
for(int i=0;i<3;i++)
{
    arr[i]=val>>i&1;
    if(arr[i])
    {
        num++;//正面次数
    }
}
if(num==2) //少阳
{
    type=1;
    s+="少阳:---\n";
}
else if(num==1) //少阴
{
    type=3;
    s+="少阴:- -\n";
}
else if(num==0)//老阳
{
    type=2;
    s+="老阳:---\n";
}
else if(num==3)//老阴
{
    type=4;
    s+="老阴:- -\n";
}
```

##### 一卦

```cpp
//六爻为一卦
//int type; //1-少阳 2--老阳 3--少阴 4--老阴
s+="卦象为：\n";
for(int i=0;i<6;i++)
{
    if(arr[i]==1||arr[i]==2) //1-少阳 2--老阳
    {
        s+="---\n";
    }
    else if(arr[i]==3||arr[i]==4)//3--少阴 4--老阴
    {
        s+="- -\n";
    }
}
s+="变卦： \n\n";
for(int i=0;i<6;i++)
{
    if(arr[i]==1||arr[i]==4) //老阴 --> 少阳
    {
        s+="---\n";
    }
    else if(arr[i]==2||arr[i]==3)//老阳 --> 少阴
    {
        s+="- -\n";
    }
}
```

### 梅花易数

相传是是北宋邵雍所传的一种占筮方法 。据说邵雍某日在花园观梅，见二雀争枝坠地，便设卦布算，推知明晚有女子来折梅丧腿。后人便称此种筮法为“观梅占数”。世传有《梅花易数》一书，又以书名其术。

#### 起卦

1. 年月日时起卦。以年月日数相加除以8，所得余数为上卦；年月日时数相加除以8，所得余数为下卦；即所谓“卦除以八”。年月日数之和除以6，其余数则为动爻。即所谓“爻除以六”。古代年月日时皆以干支记，现在通行年以支记，即子年1、丑年2、寅3……亥12。月、日皆以序数记，时以十二支记，子时为夜间11时至凌晨1时，丑时1-3点，以下类推。上下卦均以先天八卦次序：乾1，兑2，离3，震4，巽5，坎6，艮7，坤8。下同此。
2. 物数起卦。凡见到可数之物，即以此数为上卦，以见时起下卦。以卦数加时数除以6，余数为动爻。
3. 声音起卦。凡听到声音，如鸟鸣、高门声、打击声等，数得几声，起作上卦；加时数配作下卦。如听到间断之声，也可以用前面的声数作上卦，后面的声音作下卦。以卦数加时数除以6，余数为动爻
4. 字数起卦。凡见字数，如为偶数，则上下平分，一半为上卦，一半为下卦。如遇奇数，则少一字为上卦，多一字为下卦，取清轻者为天，重浊者为地之义。如字数多，直接以字数起卦；字数少，以字的笔画起卦。如一个字，则左边笔画为上卦，右边笔画为下卦。
5. 人物起卦。凡见人物，以人物为上卦（后天八卦取象，如老男为乾、少女为兑之类），其方位（后天八卦方位）为下卦。
6. 总之，万事万物皆可随时随地空手起卦。

时间有限，梅花占数暂无程序实现。。。

## 程序演示

### 开始界面

![image-20220425133245028](E:\document\courseNote\Second_semester_of_sophomore_year\shushu\assignment\中国古代数术文化结课论文.assets\image-20220425133245028.png)

### 春秋古筮法

#### 主页

![image-20220425133326174](E:\document\courseNote\Second_semester_of_sophomore_year\shushu\assignment\中国古代数术文化结课论文.assets\image-20220425133326174.png)

#### 算一卦

![image-20220425133357454](E:\document\courseNote\Second_semester_of_sophomore_year\shushu\assignment\中国古代数术文化结课论文.assets\image-20220425133357454.png)

#### 模拟一卦过程

![image-20220425133427541](E:\document\courseNote\Second_semester_of_sophomore_year\shushu\assignment\中国古代数术文化结课论文.assets\image-20220425133427541.png)

#### 模拟一爻过程

![image-20220425133450580](E:\document\courseNote\Second_semester_of_sophomore_year\shushu\assignment\中国古代数术文化结课论文.assets\image-20220425133450580.png)

#### 模拟一变过程

![image-20220425133510676](E:\document\courseNote\Second_semester_of_sophomore_year\shushu\assignment\中国古代数术文化结课论文.assets\image-20220425133510676-16508649187251.png)

### 纳甲筮法

#### 主页

![image-20220425133603529](E:\document\courseNote\Second_semester_of_sophomore_year\shushu\assignment\中国古代数术文化结课论文.assets\image-20220425133603529.png)

### 算一卦

![image-20220425133619964](E:\document\courseNote\Second_semester_of_sophomore_year\shushu\assignment\中国古代数术文化结课论文.assets\image-20220425133619964.png)

#### 算一爻

![image-20220425133638403](E:\document\courseNote\Second_semester_of_sophomore_year\shushu\assignment\中国古代数术文化结课论文.assets\image-20220425133638403.png)

## 结语

​	通过对筮法的模拟过程，我对我们国家的易占文化才有了深刻的认识和理解。我国古代数术源远流长，至今传承不绝。其地位，则由知识精阶层流落民间江湖，从中心走向边缘。正史目录通常由官方主持编修，代表官方士大夫精英阶层的立场和眼光。从《汉书·艺文志》到《隋书·经籍志》以至《四库全书》，数术或术数的目录排列上地位不断下降，数量不断减少。但数术作为一种实用知识，在中国古代社会从未绝迹消亡。宋代印刷术普及后，日用数术类书籍更是出版印刷品中的大宗，成为研究社会大众日常生活史的绝佳资料。 我们也应该学习和发扬中国古代数术文化，不要让其失落于历史长河中。

​	程序代码：

## 参考文献

《中国古代数术文化》$PPT$   武汉大学历史学院：晏昌贵